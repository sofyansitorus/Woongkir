!function(s){"use strict";var u={storeCountry:function(){this.getCountry().length||s.getJSON(woongkir_params.json.country_url,function(t){t.sort(function(t,i){return t.country_name>i.country_name?1:i.country_name>t.country_name?-1:0}),Lockr.set(woongkir_params.json.country_key,t)})},getCountry:function(t,i){var e=Lockr.get(woongkir_params.json.country_key);return e&&void 0!==e?t&&t===Object(t)?this.searchLocation(e,t,i):e:[]},storeProvince:function(){this.getProvince().length||s.getJSON(woongkir_params.json.province_url,function(t){t.sort(function(t,i){return t.province_name>i.province_name?1:i.province_name>t.province_name?-1:0}),Lockr.set(woongkir_params.json.province_key,t)})},getProvince:function(t,i){var e=Lockr.get(woongkir_params.json.province_key);return e&&void 0!==e?t&&t===Object(t)?this.searchLocation(e,t,i):e:[]},storeCity:function(){this.getCity().length||s.getJSON(woongkir_params.json.city_url,function(t){t.sort(function(t,i){return t.city_name>i.city_name?1:i.city_name>t.city_name?-1:0}),Lockr.set(woongkir_params.json.city_key,t)})},getCity:function(t,i){var e=Lockr.get(woongkir_params.json.city_key);return e&&void 0!==e?t&&t===Object(t)?this.searchLocation(e,t,i):e:[]},storeSubdistrict:function(){this.getSubdistrict().length||s.getJSON(woongkir_params.json.subdistrict_url,function(t){t.sort(function(t,i){return t.subdistrict_name>i.subdistrict_name?1:i.subdistrict_name>t.subdistrict_name?-1:0}),Lockr.set(woongkir_params.json.subdistrict_key,t)})},getSubdistrict:function(t,i){var e=Lockr.get(woongkir_params.json.subdistrict_key);return e&&void 0!==e?t&&t===Object(t)?this.searchLocation(e,t,i):e:[]},searchLocation:function(t,i,e){var n=this,r=!1;switch(e=e||"find"){case"filter":r=t.filter(function(t){return n.isLocationMatch(t,i)});break;default:r=t.find(function(t){return n.isLocationMatch(t,i)})}return r||!1},isLocationMatch:function(t,i){var e=!0;for(var n in i)t.hasOwnProperty(n)&&String(t[n]).toLowerCase()===String(i[n]).toLowerCase()||(e=!1);return e}};u.storeCountry(),u.storeProvince(),u.storeCity(),u.storeSubdistrict(),s(document).ready(function(){s(document.body).on("country_to_state_changed",function(t,i,e){var o,n,a,c;n=e,(o=i)&&void 0!==o&&n&&void 0!==n&&(s("#calc_shipping_address_2_field").remove(),s(n).find("#billing_city, #shipping_city, #calc_shipping_city, #billing_address_2, #shipping_address_2").each(function(){var t=this;if(s(t).show().closest(".form-row").find(".select2-container").remove(),"ID"===o){if(s(t).is("input")){var e=s("<select></select>");if(s.each(t.attributes,function(t,i){switch(i.name){case"type":break;case"value":e.attr("data-value",i.value);break;default:e.attr(i.name,i.value.replace("input-text","woongkir-input-text").replace("select2-hidden-accessible",""))}}),0<=s(t).attr("id").indexOf("calc_shipping_city")){var i=s("#calc_shipping_postcode_field").clone().attr({id:s(t).attr("id").replace("city","address_2")+"_field"}).empty().insertBefore("#calc_shipping_postcode_field"),n=e.clone().append('<option value="">'+woongkir_params.text.select_subdistrict+"</option>");n.attr({id:s(t).attr("id").replace("city","address_2"),name:s(t).attr("id").replace("city","address_2")}).appendTo(i),s().select2&&n.select2({placeholderOption:"first",width:"100%"})}var r=0<=s(t).attr("id").indexOf("city")?woongkir_params.text.select_city:woongkir_params.text.select_subdistrict;e.append('<option value="">'+r+"</option>"),s(t).replaceWith(e),s().select2&&e.select2({placeholderOption:"first",width:"100%"})}}else if(s(t).is("select")){var a=s('<input type="text" />');s.each(t.attributes,function(t,i){switch(i.name){case"data-value":a.val(i.value);break;default:a.attr(i.name,i.value.replace("woongkir-input-text","input-text").replace("select2-hidden-accessible",""))}}),s(t).replaceWith(a)}}),n.find("#billing_state, #shipping_state, #calc_shipping_state").on("change",function(){if(a=!1,"ID"===o){var t=s(this),n=s("#"+t.attr("id").replace("state","city"));if(n.find("option").not(":first").remove(),t.val()&&t.val().length&&(a=u.getProvince({code:t.val()}))){var i=u.getCity({province_id:a.province_id},"filter");i&&(s.each(i,function(t,i){var e=n.data("value")===i.type+" "+i.city_name?" selected":"";n.append('<option value="'+i.type+" "+i.city_name+'"'+e+">"+i.type+" "+i.city_name+"</option>")}),n.trigger("change"))}}}),n.find("#billing_city, #shipping_city, #calc_shipping_city").on("change",function(){if("ID"===o){var t=s(this);t.attr("data-value",t.val());var n=s("#"+t.attr("id").replace("city","address_2"));if(n.find("option").not(":first").remove(),n.trigger("change"),t.val()&&t.val().length&&a){var i=t.val().split(" ").slice(0,1).join(""),e=t.val().split(" ").slice(1).join(" ");if(c=u.getCity({province_id:a.province_id,type:i,city_name:e})){var r=u.getSubdistrict({province_id:a.province_id,city_id:c.city_id},"filter");r&&(s.each(r,function(t,i){var e=n.data("value")===i.subdistrict_name?" selected":"";n.append('<option value="'+i.subdistrict_name+'"'+e+">"+i.subdistrict_name+"</option>")}),n.trigger("change"))}}}}),n.find("#billing_address_2, #shipping_address_2").on("change",function(){s(this).attr("data-value",s(this).val())}),s(function(){n.find("#billing_state, #shipping_state, #calc_shipping_state").trigger("change")}))}),s(document.body).on("updated_wc_div",function(){s(":input.country_to_state").trigger("change")}),s(document.body).on("updated_shipping_method",function(){s(":input.country_to_state").trigger("change")})})}(jQuery);